<!DOCTYPE html>
<html lang="en">
  
  <body>
  <!-- ************ Table Styling from https://datatables.net/ *************/ -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/select/1.2.5/css/select.dataTables.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.5.1/css/buttons.dataTables.min.css">
<!--  <link rel="stylesheet" href="https://cdn.datatables.net/scroller/1.4.4/css/scroller.dataTables.min.css">-->
  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/select/1.2.5/js/dataTables.select.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/1.5.1/js/dataTables.buttons.min.js"></script>'
  <!--  <script src="https://cdn.datatables.net/scroller/1.4.4/js/dataTables.scroller.min.js"></script>'-->

  <div class="containerCreatePick">

  <div class="pickStaffBox">
  <fieldset name="pickStaffGroup" id="pickStaffGroup">
  <legend>Designate Picker</legend>
  <form class="create" name="create", id="create" action="pickOut.php" method="post">
  <label for="pickStaff">Picker </label>
  <select name="pickStaff" id="pickStaff" autofocus>
    <option value="-- Warehouse Staff Name --">-- Warehouse Staff Name --</option>
    <option value="BradleyProtano">Bradley Protano</option>
    <option value="DanielBaker">Daniel Baker</option>
  </select><br>


  </fieldset>
  </div>


  <div class="pickTableBox">
  <fieldset name="pickTableGroup" id="pickTableGroup">
  <legend>Orders Released for Pick</legend>
  <fieldset name="blank" id="blank">
  <?php $sql = $conn->query(
  "select o.order_id, c.name, o.order_status, o.order_date, o.order_expected_date, o.order_lines 
  from order_header o, customer c 
  where c.customer_id = o.customer_id and o.order_status = 'Released for pick'
  group by o.order_id 
  order by o.order_expected_date"); ?>

  <table id="example" class="display" style="width:100%"><br>
  <thead>
  <tr> 
  <th align="left"></th>
  <th align="left">Order Number</th>
  <th align="left">Customer Name</th>
  <th align="left">Expected by Date</th>
  <th align="right">Order Detail Lines</th>
  <th align="left">Date Created</th>
  </tr>
  </thead>
  <tbody> 

  <?php while($row = $sql->fetch(PDO::FETCH_ASSOC)) {
    echo '<tr>';
    echo '<td></td>';
    echo '<td align="left">';
    echo 'PB-AIP-';
    echo $row['order_id'];
    echo '</td>';

    echo '<td>';
    echo $row['name'];
    echo '</td>';

    echo '<td align="right">';
    echo $row['order_expected_date'];
    echo '</td>';

    echo '<td align="right">';
    echo $row['order_lines'];
    echo '</td>';

    echo '<td align="right">';
    echo $row['order_date'];
    echo '</td>';
    echo '</tr>';
  } ?>
  </tbody>
  </table>
  </fieldset>
  </fieldset>
  </div>

  <!-- cancel box -->
  <div class="cancelBox">
  <button class="button buttonReset" type="reset" onclick="return confirm_reset();">Cancel</button>
  </div>
	  
  <!-- submit box -->
  <div class="submitBox">
  <button class="button buttonSubmit" name="buttonS" id="buttonS" type="submit">Submit</button>
  <input type="hidden" name="which" id="which" value="0">
  <input type="hidden" name="rowIds" id="rowIds" value="0">
  </div>
  </form>

  </div>

  <script>
  /*************** Table Styling from https://datatables.net/ ************/
    $(document).ready(function() {
      var table = $('#example').DataTable( {
	 columnDefs: [ {
           orderable: false,
           className: 'select-checkbox',
           targets:   0
	 } ],
         select: {  style:   'multi+shift',
                    selector: 'td:first-child'
                      
         },
         order: [[ 1, 'asc' ]],
         dom:        'Bfrtip',
       /*  deferRender:    true,
         scrollY:        200,
         scrollCollapse: true,
         scroller:       true,
         select:      'multi',*/
         buttons: [
           {
             text: 'Select all',
             action: function () {
               table.rows().select();
             }
           },
           {
             text: 'Select none',
             action: function () {
               table.rows().deselect();
             }
           } 
         ]
       });




       $(".create").on( "submit", function() {
         //verify user wants these orders for the report
         if(confirm("Produce Pick Report with these orders?") == true) {
           if(table.rows( { selected: true} ).count() > 0 && document.getElementById("pickStaff").value != "-- Warehouse Staff Name --"){
             document.getElementById("rowIds").value = Object.values(table.rows( { selected: true} ).data());
           }
           else {
             alert("Must select a picker and at least one customer order.");
  	     return false;
           }
         } 
         else{
           //prevent refresh or exit of page
  	   return false;
         }
       });

  });
  </script>

  <script>
	function confirm_reset(){
	  return confirm("Are you sure you want to discard this pick report?");
 	}
  </script>
</body>
</html>
